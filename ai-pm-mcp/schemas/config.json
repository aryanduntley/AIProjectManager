{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "config.json",
  "title": "User Settings Configuration Schema",
  "description": "Schema for user configuration settings in .ai-pm-config.json",
  "type": "object",
  "properties": {
    "project": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name"
        },
        "maxFileLineCount": {
          "type": "integer",
          "minimum": 100,
          "maximum": 5000,
          "default": 900,
          "description": "Maximum lines per file before modularization"
        },
        "avoidPlaceholders": {
          "type": "boolean",
          "default": true,
          "description": "Avoid placeholder text in generated code"
        },
        "autoModularize": {
          "type": "boolean",
          "default": true,
          "description": "Automatically modularize files exceeding line limit"
        },
        "backwardsCompatibility": {
          "type": "boolean",
          "default": false,
          "description": "Maintain backwards compatibility when updating code"
        },
        "productionMode": {
          "type": "boolean",
          "default": false,
          "description": "Whether project is in production mode"
        },
        "minifyJson": {
          "type": "boolean",
          "default": true,
          "description": "Minify JSON files to save space"
        }
      },
      "required": ["name"],
      "additionalProperties": false
    },
    "documentation": {
      "type": "object",
      "properties": {
        "readmeJsonFilename": {
          "type": "string",
          "default": "README",
          "description": "Base filename for JSON README files"
        },
        "readmeMdFilename": {
          "type": "string", 
          "default": "README",
          "description": "Base filename for Markdown README files"
        },
        "autoUpdateReadme": {
          "type": "boolean",
          "default": true,
          "description": "Automatically update README files"
        },
        "includeFileChains": {
          "type": "boolean",
          "default": true,
          "description": "Include file dependency chains in README"
        },
        "includeThemeReferences": {
          "type": "boolean",
          "default": true,
          "description": "Include theme references in README"
        },
        "trackLastAssessment": {
          "type": "boolean",
          "default": true,
          "description": "Track when files were last assessed"
        },
        "lastUpdatedBehavior": {
          "type": "string",
          "enum": ["overwrite", "append", "prompt"],
          "default": "overwrite",
          "description": "How to handle last updated timestamps"
        }
      },
      "additionalProperties": false
    },
    "contextLoading": {
      "type": "object",
      "properties": {
        "defaultMode": {
          "type": "string",
          "enum": ["theme-focused", "theme-expanded", "project-wide"],
          "default": "theme-focused",
          "description": "Default context loading mode"
        },
        "escalationEnabled": {
          "type": "boolean",
          "default": true,
          "description": "Allow automatic context escalation"
        },
        "readmeFirst": {
          "type": "boolean",
          "default": true,
          "description": "Load README files before code files"
        },
        "maxFlowFiles": {
          "type": "integer",
          "minimum": 1,
          "maximum": 20,
          "default": 3,
          "description": "Maximum number of flow files to load"
        },
        "contextModes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "mode": {
                "type": "string",
                "enum": ["theme-focused", "theme-expanded", "project-wide"]
              },
              "description": {
                "type": "string"
              }
            },
            "required": ["mode", "description"],
            "additionalProperties": false
          },
          "description": "Available context loading modes"
        }
      },
      "additionalProperties": false
    },
    "tasks": {
      "type": "object",
      "properties": {
        "autoTaskCreation": {
          "type": "boolean",
          "default": false,
          "description": "Automatically create tasks from user requests"
        },
        "parallelTasksEnabled": {
          "type": "boolean",
          "default": true,
          "description": "Allow multiple tasks to be active"
        },
        "maxActiveSidequests": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 3,
          "description": "Maximum active sidequests per task"
        },
        "sidequestManagement": {
          "type": "object",
          "properties": {
            "allowMultipleSidequests": {
              "type": "boolean",
              "default": true,
              "description": "Allow multiple sidequests per task"
            },
            "maxSimultaneousSidequests": {
              "type": "integer",
              "minimum": 1,
              "default": 3,
              "description": "Max simultaneous sidequests"
            },
            "warnWhenApproachingLimit": {
              "type": "boolean",
              "default": true,
              "description": "Warn when approaching sidequest limit"
            },
            "limitExceededBehavior": {
              "type": "string",
              "enum": ["prompt_user_options", "block", "queue"],
              "default": "prompt_user_options",
              "description": "What to do when limit exceeded"
            }
          },
          "additionalProperties": false
        },
        "resumeTasksOnStart": {
          "type": "boolean",
          "default": false,
          "description": "Resume tasks when starting new session"
        },
        "statusMarkers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": ["pending", "in-progress", "blocked", "reviewing", "completed", "cancelled"],
          "description": "Available task status values"
        }
      },
      "additionalProperties": false
    },
    "archiving": {
      "type": "object",
      "properties": {
        "projectlogicSizeLimit": {
          "type": "string",
          "pattern": "^\\d+[KMG]?B$",
          "default": "2MB",
          "description": "Size limit for projectlogic.jsonl"
        },
        "noteworthySizeLimit": {
          "type": "string",
          "pattern": "^\\d+[KMG]?B$", 
          "default": "1MB",
          "description": "Size limit for noteworthy.json"
        },
        "maxArchiveFiles": {
          "type": "integer",
          "minimum": 1,
          "default": 100,
          "description": "Maximum number of archive files to keep"
        },
        "deleteArchivesOlderThan": {
          "type": "integer",
          "minimum": 1,
          "default": 90,
          "description": "Delete archives older than N days"
        }
      },
      "additionalProperties": false
    },
    "placeholders": {
      "type": "object",
      "properties": {
        "trackPlaceholders": {
          "type": "boolean",
          "default": true,
          "description": "Track placeholder comments in code"
        },
        "customMarkers": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": ["HACK", "REVIEW", "SECURITY"],
          "description": "Custom placeholder markers to track"
        },
        "priorityMapping": {
          "type": "object",
          "patternProperties": {
            "^[A-Z_]+$": {
              "type": "string",
              "enum": ["low", "medium", "high", "critical"]
            }
          },
          "description": "Priority mapping for different marker types"
        }
      },
      "additionalProperties": false
    },
    "themes": {
      "type": "object",
      "properties": {
        "autoDiscovery": {
          "type": "boolean",
          "default": true,
          "description": "Automatically discover themes"
        },
        "discoveryKeywords": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Keywords for theme discovery"
        },
        "updateOnFileChange": {
          "type": "boolean",
          "default": true,
          "description": "Update themes when files change"
        },
        "conflictResolution": {
          "type": "string",
          "enum": ["merge", "prompt", "skip"],
          "default": "merge",
          "description": "How to resolve theme conflicts"
        },
        "sharedFileThreshold": {
          "type": "integer",
          "minimum": 2,
          "default": 3,
          "description": "Minimum themes for file to be marked shared"
        }
      },
      "additionalProperties": false
    },
    "validation": {
      "type": "object",
      "properties": {
        "enforceTaskMilestoneReference": {
          "type": "boolean",
          "default": true,
          "description": "Require tasks to reference milestones"
        },
        "enforceTaskThemeReference": {
          "type": "boolean",
          "default": true,
          "description": "Require tasks to reference themes"
        },
        "flowReferenceValidation": {
          "type": "string",
          "enum": ["strict", "smart", "none"],
          "default": "smart",
          "description": "Flow reference validation level"
        },
        "crossFlowAwareness": {
          "type": "boolean",
          "default": true,
          "description": "Validate cross-flow dependencies"
        },
        "contextEscalationAllowed": {
          "type": "boolean",
          "default": true,
          "description": "Allow context escalation"
        },
        "warnOnMissingReferences": {
          "type": "boolean",
          "default": true,
          "description": "Warn about missing references"
        },
        "validateFileExistence": {
          "type": "boolean",
          "default": true,
          "description": "Validate that referenced files exist"
        },
        "requireApprovalForStructureChanges": {
          "type": "boolean",
          "default": true,
          "description": "Require approval for structure changes"
        },
        "validateJsonSchemas": {
          "type": "boolean",
          "default": true,
          "description": "Validate JSON files against schemas"
        }
      },
      "additionalProperties": false
    },
    "ai": {
      "type": "object",
      "properties": {
        "contextLoadingStrategy": {
          "type": "string",
          "enum": ["intelligent", "conservative", "aggressive"],
          "default": "intelligent",
          "description": "AI context loading strategy"
        },
        "maxContextFiles": {
          "type": "integer",
          "minimum": 10,
          "default": 50,
          "description": "Maximum files to load in context"
        },
        "preferRecentFiles": {
          "type": "boolean",
          "default": true,
          "description": "Prefer recently modified files"
        },
        "includeRelatedThemes": {
          "type": "boolean",
          "default": true,
          "description": "Include related themes in context"
        },
        "loadFlowSteps": {
          "type": "boolean",
          "default": true,
          "description": "Load flow step details"
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["project"],
  "additionalProperties": false
}